# Table of Contents
1. [Table of Contents](#table-of-contents)
2. [Overview](#overview)
3. [Directory Structure](#directory-structure)
4. [Requirements](#requirements)
    1. [PostgreSQL](#postgresql)
    2. [Big Query Authentication](#big-query-authentication)
    3. [HuggingFace Token](#huggingface-token)
    4. [Python](#python)
5. [Running](#running)
    1.  [Get Packages](#get-packages)
    2.  [Filter Packages](#filter-packages)
    3.  [Check Adoption](#check-adoption)

# Overview
Tools for verifying signatures on PyPI, Docker Hub, Maven Central, and Hugging Face.
This repository contains a collection of scripts that can be used in conjunction to verify signatures on each of the afore mentioned registries.
These scripts require some preliminary setup to collect data.
Many of these scripts are also designed to be paralellized due to the large amount of data on any given registry.
The order of operations for these scripts are as follows:
1. Collect a list of all packages from a given registry
2. Apply filters to that list of packages
3. On the remaining packages, check the adoption of signatures

# Directory Structure
```bash
.
├── data                    # Data for each registry. Split by registry.
│   ├── docker              # These folders are generated by scripts
│   ├── huggingface         # in src.
│   ├── maven
│   ├── npm
│   └── pypi
├── logs                    # Logs for each script. Split by registry.
│   ├── docker              # These folders are generated by scripts
│   ├── huggingface         # in src.
│   ├── maven
│   ├── npm
│   └── pypi
└── src                     # Source files: Unique functions split by registry
    ├── docker              
    ├── huggingface         
    ├── maven
    ├── npm
    ├── pypi
    ├── packages.py         # Script retrieves a list of packages/registry
    ├── filter.py           # Script filters list of packages
    └── adoption.py         # Script checks signatures in remaining packages
```
# Requirements
## PostgreSQL
The initial dataset generation script [packages.py](src/packages.py) interfaces with a PostgreSQL database with a data dump from [ecosyste.ms](https://packages.ecosyste.ms/open-data).
Before running the [packages.py](src/packages.py) script, a valid PostgreSQL server should be running with the _packages_production_ database available.
Please be aware that **this database is about 200G when rebuilt**.
By default, the [packages.py](src/packages.py) script is configured to interface with a PostgreSQL server running on the localhost, to change this configuration, you will have to modify the `db_credentials` variable in the code.
The script also checks the `PSQL_Password` environmental variable for a password.
That can be set in linux using the following command:
```bash
export PSQL_Password=<my_psql_password>
```

## Big Query Authentication
[packages.py](src/packages.py) also uses access to Google's BigQuery to fetch data for PyPI.
For this to work, a valid service account key must be added to the `GOOGLE_APPLICATION_CREDENTIALS` environment variable.
This can be accomplished in linux using the following command:
```bash
export GOOGLE_APPLICATION_CREDENTIALS=<creds_file>
```
Check documentation at https://cloud.google.com/docs/authentication/provide-credentials-adc for more information.

## HuggingFace Token
[packages.py](src/packages.py) requires an access token to interface with the HuggingFace API.
Pass a file containing this token to the script in command line.

## Python
The scripts for this project are written in Python.
The [requirements.txt](requirements.txt) can be used to create a Python virtual environment with all necessary dependencies in _bash_ using: 
```bash
python -m venv env
source env/bin/activate
python -m pip install -r requirements.txt
```

# Running

## Get Packages
Before checking for signature adoption in each registry, we need to get a list of all packages for each registry. 
For PyPI, NPM, Docker Hub, and Maven Central, we can run the [packages.py](src/packages.py) script to generate a list of packages and versions from each registry.

Hugging Face and PyPI have special arguments. Take a look at these by using `python src/packages.py huggingface -h` and `python src/packages.py huggingface -h` respectively.

## Filter Packages


## Check Adoption
